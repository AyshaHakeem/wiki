{% macro render_wiki_tree(nodes, level=0, current_route='') %}
    {% if nodes %}
        <ul class="wiki-tree">
            {% for node in nodes %}
                {% set is_current = (not node.is_group and node.route == current_route) %}
                <li class="wiki-item {{ 'is-group' if node.is_group else 'is-page' }} {{ 'current-page' if is_current else '' }}">
                    <div class="wiki-item-content flex items-center py-2 transition-colors duration-200 {{ 'pl-8' if level == 1 else 'pl-10' if level == 2 else 'pl-12' if level >= 3 else 'pl-4' }} pr-4 {{ 'border-l-2 border-[var(--ink-gray-4)] bg-[var(--surface-gray-2)] text-[var(--ink-gray-9)]' if is_current else 'hover:bg-[var(--surface-gray-2)] cursor-pointer' }}"
                         {% if node.is_group %}@click="toggleNode('{{ node.name }}')"{% endif %}
                         data-route="{{ node.route }}"
                         data-node-id="{{ node.name }}"
                         data-is-current="{{ 'true' if is_current else 'false' }}"
                         data-current-route="{{ current_route }}">

                        {% if node.is_group %}
                            <div class="wiki-link flex items-center justify-between text-[var(--ink-gray-7)] no-underline flex-1 transition-colors duration-200">
                                <span class="wiki-title text-sm font-medium">{{ node.title }}</span>
                                <svg class="w-4 h-4 text-[var(--ink-gray-4)] transition-transform duration-200 flex-shrink-0"
                                     :class="{ 'rotate-180': isExpanded('{{ node.name }}') }"
                                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        {% else %}
                            <a href="/{{ node.route }}" class="wiki-link flex items-center no-underline flex-1 transition-colors duration-200 {{ 'text-[var(--ink-gray-9)] font-medium' if is_current else 'text-[var(--ink-gray-6)] hover:text-[var(--ink-gray-9)]' }}">
                                <span class="wiki-title text-sm {{ 'font-medium' if is_current else 'font-normal' }}">{{ node.title }}</span>
                            </a>
                        {% endif %}
                    </div>

                    {% if node.children %}
                        <div class="wiki-children overflow-hidden border-l border-[var(--outline-gray-2)] ml-4"
                             x-show="isExpanded('{{ node.name }}')"
                             x-collapse>
                            {{ render_wiki_tree(node.children, level + 1, current_route) }}
                        </div>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% endif %}
{% endmacro %}
